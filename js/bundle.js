!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(2);i.a.createMap(),$(".modal").modal(),$("select").material_select(),document.querySelector("#btn-add").addEventListener("click",onClickPlusButton),Array.from(document.querySelectorAll("[type=checkbox]")).forEach(e=>e.addEventListener("click",onClickFiltersCheck)),document.querySelector("#event-form form").addEventListener("submit",onSubmitForm),window.addEventListener("load",function(){o.a.loadAll().then(e=>{e.forEach(e=>{i.a.createMarker(e)})})}),$("#map").outerHeight($(window).outerHeight()-$("nav").outerHeight()-$("#search").parent().outerHeight()),io(backendSocketURL).on("event-notification",e=>{const t=new o.a(e.id,e.type,e.description,e.position,e.confirmations,e.infirmations);Materialize.toast('<img src="'+icons[t.type]+'"> Nouvelle notification : '+labels[t.type],2e3,"rounded"),i.a.createMarker(t)})},function(e,t,n){"use strict";class o{constructor(e="",t,n,o,i=0,r=0){this.id=e,this.type=t,this.description=n,this.position=o,this.confirmations=i,this.infirmations=r}save(){return fetch(`https://vanilla-tinder.firebaseio.com/notifications/${this.id}.json`,{method:"PUT",body:JSON.stringify(this)})}update(){return fetch(`https://vanilla-tinder.firebaseio.com/notifications/${this.id}.json`,{method:"PATCH",body:JSON.stringify(this)})}static loadAll(){return fetch("https://vanilla-tinder.firebaseio.com/notifications.json").then(e=>e.json()).then(e=>Object.keys(e).map(t=>{const n=e[t];return new o(n.id,n.type,n.description,n.position,n.confirmations,n.infirmations)}))}}t.a=o},function(e,t,n){"use strict";const o=[],i=[],r={},c=["blesse","mort","travaux","bouchon"];class a{static createMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:-25.363,lng:131.044},disableDefaultUI:!0}),map.addListener("click",onClickMap),navigator.geolocation.getCurrentPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};map.setCenter(t)}),a.initSearchBoxes()}static getInfoWindowContent(e){const t=document.getElementById("infoWindow").content.cloneNode(!0);return t.querySelector("img").setAttribute("src",icons[e.type]),t.querySelector(".info-title span").textContent=labels[e.type],t.querySelector("p").textContent=e.description,t.querySelector("div.div-confirm").setAttribute("id","infowindow-"+e.id),t.querySelector("#btn-confirm span").textContent=e.confirmations||0,t.querySelector("#btn-infirm span").textContent=e.infirmations||0,t.querySelector("div.main").innerHTML}static getOverWindowContent(e){const t=document.getElementById("overWindow").content.cloneNode(!0);return t.querySelector("img").setAttribute("src",icons[e.type]),t.querySelector(".info-title span").textContent=labels[e.type],t.querySelector("p").textContent=e.description,t.querySelector("div.main").innerHTML}static createInfoWindow(e,t){const n=new google.maps.InfoWindow({content:a.getInfoWindowContent(e)}),r=new google.maps.InfoWindow({content:a.getOverWindowContent(e)});o.push(n),i.push(r),n.addListener("domready",function(){const t="#infowindow-"+e.id;document.querySelector(`${t} #btn-confirm`).addEventListener("click",function(t){t.preventDefault(),e.confirmations++,e.update().then(t=>{this.querySelector("span").textContent=e.confirmations}).catch(e=>{alert("Une erreur nous empêche de mettre à jour le statut."),console.error(e)})}),document.querySelector(`${t} #btn-infirm`).addEventListener("click",function(t){t.preventDefault(),e.infirmations++,e.update().then(t=>{this.querySelector("span").textContent=e.infirmations}).catch(e=>{alert("Une erreur nous empêche de mettre à jour le statut."),console.error(e)})})}),t.addListener("click",function(){o.concat(i).forEach(e=>e.close()),n.open(map,t),n.isOpen=!0}),n.addListener("closeclick",function(){n.isOpen=!1}),t.addListener("mouseover",function(){n.isOpen||r.open(map,t)}),t.addListener("mouseout",function(){r.close()})}static setMarkersVisibility(e,t){!t&&c.includes(e)?c.splice(c.findIndex(t=>t===e),1):t&&!c.includes(e)&&c.push(e),r[e].forEach(e=>{e.setVisible(t)})}static createMarker(e){const t={url:icons[e.type],scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)},n=c.includes(e.type),o=new google.maps.Marker({map:map,position:e.position,icon:t,visible:n});r[e.type]||(r[e.type]=[]),r[e.type].push(o),a.createInfoWindow(e,o)}static createSearchBox(e){const t=document.getElementById(e);return new google.maps.places.SearchBox(t)}static initSearchBoxes(){globalSearchBox=a.createSearchBox("search"),globalSearchBox.addListener("places_changed",onChooseGlobalSearchBox),modalSearchBox=a.createSearchBox("search-in-form"),modalSearchBox.addListener("places_changed",onChooseModalSearchBox)}}t.a=a}]);